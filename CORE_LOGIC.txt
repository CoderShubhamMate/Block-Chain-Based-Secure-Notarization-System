BBSNS - Core System Logic & Operational Principles

This document summarizes the authoritative logic governing the Blockchain-Based Secure Notarization System (BBSNS).

1. AUTHENTICATION & SECURITY (3-FACTOR HARDENING)
==============================================
- 3-Factor Enforcement: Login requires a verified Password + National ID Hash + EIP-191 Wallet Signature + Face Liveness (Descriptor Matching).
- Nonce Selection: Every signature request is bound to a server-generated 128-bit entropy nonce (expires in 5 minutes) to prevent Replay Attacks.
- Progressive Backoff: Multi-layered rate limiting (IP-based and Wallet-based) enforces cooling periods (30s to 1h) after sequential failures to stop brute-force/credential-stuffing.
- Role-Based Access (RBAC): REST endpoints are strictly guarded by JWT middleware (`authMiddleware`) and specific role checks (`requireRole('admin' | 'notary')`).

**Technical Implementation:**
- Auth Engine: Built using `jsonwebtoken` for stateless session management and `bcrypt` for industry-standard password salting and hashing.
- Verification: Uses the `ethers.js` library to cryptographically verify that the wallet signature matches the expected address and active server nonce.
- Rate Limiting: Implemented via `express-rate-limit` combined with a persistent database table (`auth_failures`) to ensure backoff periods persist even after server restarts.

2. DOCUMENT NOTARIZATION (HASH AUTHORITY)
=========================================
- Server-Side Hashing: The server acts as the SOLE HASH AUTHORITY. It computes the SHA-256 hash from the raw bytes of an uploaded file.
- Client Trust: The system rejects client-provided hashes to prevent users from submitting falsified metadata for documents the server hasn't seen.
- Economy/Metering: Every document submission triggers an on-chain burn of NTKR submission tokens via a category-based logic (verified in `documents.js`).
- Privacy (Task C.4): Original document files are automatically DELETED from the server storage immediately after a Notary Finalizes the action (Approve/Reject).
- Fingerprinting: A summary fingerprint (SHA-256 of status + notary_wallet + doc_hash) is stored to ensure the DB record remains tamper-proof even if the database is compromised.

**Technical Implementation:**
- Hashing Strategy: Utilizes the Node.js native `crypto` module to generate SHA-256 fingerprints directly from the file stream provided by `multer`.
- File Lifecycle: Files are temporarily buffered to an automated `uploads/` directory and purged using the filesystem `fs.unlinkSync` method once the database record is finalized.
- Economy Logic: Backend services interact with the NTKR Smart Contract via a secure signer to automate the "burn-on-submission" fee model.

3. GOVERNANCE & ADMINISTRATION (DECENTRALIZED BOOTSTRAP)
=======================================================
- Genesis Flow (Phase 0): If the system has 0 admins, it grants "Exceptional Authority" to a bootstrap wallet defined in the backend environment.
- Institutional Promotion (Phase 1): The bootstrap admin must use their power to promote the first set of permanent admins via a 1-vote quorum.
- Autonomous Quorum (Phase 2): Once admins are established, the system automatically transitions to a dynamic quorum:
    * 1 Admin: Threshold = 1
    * 2 Admins: Threshold = 2
    * 3+ Admins: Threshold = 3
- Multisig Execution: High-privilege actions (Banning users, overriding records) can ONLY be executed after the consensus threshold is met in the `governance_votes` table.

**Technical Implementation:**
- State Management: Structured using a relational model with `governance_proposals` and `governance_votes` tables.
- Decision Logic: The backend calculates thresholds dynamically in real-time. Execution logic is wrapped in database transactions (BEGIN/COMMIT) to ensure atomicityâ€”the action happen only if the vote is fully recorded.

4. BLOCKCHAIN LAYER (IMMUTABILITY)
==================================
- Immutability: Once a document is approved or rejected by a Notary, the hash is recorded on the Binance Smart Chain (BSC) via the `DocumentRegistry` contract.
- Single-Write Enforcement: The smart contract (`recordAction`) prevents any modification of an existing document hash record, ensuring historical truth cannot be rewritten.
- Token Utility: NTK tokens empower notaries, while NTKR tokens serve as the daily submission allowance for users.

**Technical Implementation:**
- Smart Contracts: Written in Solidity v0.8.20 and deployed via the Hardhat framework.
- Interaction: The system uses `ethers.js` providers to communicate with the Binance Smart Chain RPC. Contract logic uses `mapping(bytes32 => DocumentRecord)` for efficient O(1) lookups of notarization proof.

5. DESKTOP & UI ARCHITECTURE
============================
- Headless Backend: The backend is a standard REST service. No UI rendering (AWT/JavaFX) is permitted in the core service layer.
- Electron UI Bridge: The Desktop application uses an Electron wrapper (main.js) that waits for a 200 OK health check from the Node.js backend before creating the UI window.
- Single Instance: The system enforces a single rendering instance (Chromium) to ensure UI consistency and prevent race conditions between local components.

**Technical Implementation:**
- Frontend: Built with React 18/19 and Vite for rapid development and high-performance UI rendering.
- Integration: The Electron layer acts as a secure container, interacting with the backend via standard HTTP/REST calls. This removes dependency on complex IPC bridges and ensures the desktop app stays perfectly synced with the web core.

--------------------------------------------------------------------------------
Last Updated: February 11, 2026
--------------------------------------------------------------------------------
